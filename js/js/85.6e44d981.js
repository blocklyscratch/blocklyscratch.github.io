"use strict";(globalThis["webpackChunkcircleworld"]=globalThis["webpackChunkcircleworld"]||[]).push([[85,36],{65946:(e,t,i)=>{i.r(t),i.d(t,{default:()=>X});var r=i(61758),s=i(58790),a=i(38734),o=(i(63754),i(90303)),n=i(29104),h=i(33079),l=i(71394),d={name:"shareOBJ"},u={},c={oMsgDebuger:{},bActServer:!1,bActServerTime:0,phaserStatusUpdateTime:0,phaserStatusUpdateCount:0,clientUPdateTime:0,checkServerTimes:0,currentUpdateFPS:0,currentSendFPS:0,timsFPSTooLow:10,bPlayerUserIDJoin:!1,bActServe:!1,bActServeUpdateAll:!0,bAskForJoinedRoom:!1,oToWorkerAPI:null,oToWorkerAPI2S:null,oToPhWindowAPI:null,bClientHasAllStatusAskREQCounter:30,userID:null,userName:null,vueConfigPhaser:null,playerCount:0,playerUserIDName:[],askToBeServer:!1};const p=800,m=600;i(3490),i(10239);class v extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i){super(e,p/2,m/2),e.add.existing(this),e.physics.add.existing(this),this.theScene=e,this.cursors,this.isUserLeaveHide=!1,this.play("turn"),this.userID=t,this.userName=i,this.keyPress="",this.oldKeyPress="",this.oldx="",this.oldy="",this.textName,this.sayTimeOutH=null,this.textScoreHander=null,this.sayWhat=null,this.sayWhatOld=null,this.textHit="0",this.score=0,this.textAddingScore,this.textScore="",this.heightHelf=this.height/2,this.hitBomb=0,this.setIntervalHandel=null}start(){this.textName=this.theScene.add.text(this.x,this.y+this.height+12,this.userName,{fontFamily:"Arial",fontSize:"12px",fill:"#FFFFFF"}),this.textName.setOrigin(.5),this.chatSTR="中文字ABC",this.chatStroke=this.theScene.add.text(100,400,"中文字ABC",{fontFamily:"Arial Black",fontSize:20,color:"#000000"}),this.chatStroke.setStroke("#FFFFFF",16),this.chatStroke.setVisible(!1),this.textScore=this.theScene.add.text(this.x,this.y-this.heightHelf,"S:"+this.score,{fontFamily:"Arial",fontSize:"12px",fill:"#FFFFFF"}),this.textScore.setOrigin(.5),this.textAddingScore=this.theScene.add.text(this.x,this.y-this.heightHelf-24,"+9",{fontFamily:"Arial",fontSize:"16px",fill:"#FFFF77"}),this.textAddingScore.setOrigin(.5),this.textAddingScore.visible=!1,this.textHit=this.theScene.add.text(this.x,this.y-this.heightHelf-12,"9",{fontFamily:"Arial",fontSize:"12px",fill:"#FF0000"}),this.textHit.setOrigin(.5),this.textHit.visible=!1,this.userID==this.scene.userID?(this.setDepth(15),this.chatStroke.setDepth(15),this.textName.setDepth(15),this.textScore.setDepth(14),this.textAddingScore.setDepth(16),this.textHit.setDepth(14)):(this.setDepth(10),this.chatStroke.setDepth(10),this.textName.setDepth(10),this.textScore.setDepth(9),this.textAddingScore.setDepth(11),this.textHit.setDepth(9))}setUserIDDepthTo(e){this.setDepth(e),this.chatStroke.setDepth(e),this.textName.setDepth(e),this.textScore.setDepth(e-1),this.textAddingScore.setDepth(e+1),this.textHit.setDepth(e-1)}setUserLeaveHide(e){this.isUserLeaveHide=e,this.setVelocityX(0),this.setVelocityY(0),this.play("turn"),e?(this.setUserIDDepthTo(-15),this.visible=!1):(this.setUserIDDepthTo(15),this.visible=!0)}doKeyPress(e){if(!this.hitBomb)switch(e){case"left":this.setVelocityX(-160),this.anims.play("left",!0);break;case"right":this.setVelocityX(160),this.anims.play("right",!0);break;case"up":this.setVelocityY(-160);break;case"down":this.setVelocityY(160);break;default:this.setVelocityX(0),this.setVelocityY(0),this.anims.play("turn")}}preUpdate(e,t){super.preUpdate(e,t),this.sayWhat!=this.sayWhatOld&&(this.sayWhatOld=this.sayWhat,this.doSay_chatStroke(this,this.sayWhatOld)),this.x==this.oldx&&this.y==this.oldy||(this.oldx=this.x,this.oldy=this.y,this.textScore.x=this.x,this.textScore.y=this.y-this.heightHelf,this.textHit.x=this.x,this.textHit.y=this.y-this.heightHelf-12,this.textAddingScore.x=this.x,this.textAddingScore.y=this.y-this.heightHelf-24,this.textName.x=this.x,this.textName.y=this.y+this.heightHelf+10,this.chatStroke.x=this.x-20,this.chatStroke.y=this.y-this.heightHelf-10-16)}myDestroy(){null!=this.sayTimeOutH&&clearTimeout(this.sayTimeOutH),null!=this.textScoreHander&&clearTimeout(this.textScoreHander),null!=this.setIntervalHandel&&clearInterval(this.setIntervalHandel),this.textName.destroy(),this.chatStroke.destroy(),this.textScore.destroy(),this.textAddingScore.destroy(),this.textHit.destroy()}doSay_chatStroke(e,t){null!=t&&(t.replace(/[^\x00-\xff]/g,"OO").length>20&&(t=t.slice(0,10)+"..."),e.chatStroke.setText(t),e.chatStroke.visible=!0,null!=e.sayTimeOutH&&clearTimeout(e.sayTimeOutH),e.sayTimeOutH=setTimeout((()=>{e.chatStroke.visible=!1,e.sayWhat=null,e.sayWhatOld=null}),3500))}clearHitBomb(){null!=this.setIntervalHandel&&clearInterval(this.setIntervalHandel),this.hitBomb=0,this.textHit.visible=!1,this.clearTint()}setAddingScoreText(e){"-1"==e?(this.textAddingScore.visible=!1,this.textAddingScore.setText(e)):(this.textAddingScore.setText(e),this.textAddingScore.visible=!0,this.textScoreHander=setTimeout((()=>{this.textAddingScore.visible=!1,this.textAddingScore.setText("-1")}),500))}}class S extends Phaser.Scene{constructor(){super("main")}clentServerPreload(){let e=this.game.config.phaser.init.gameIDorRoomID,t=this.game.config.phaser.init.userID;u[e+t]=JSON.parse(JSON.stringify(c));let i=u[e+t];i.vueConfigPhaser=this.game.config.phaser,i.bPlayerUserIDJoin=i.vueConfigPhaser.init.bPlayerUserIDJoin,i.userID=i.vueConfigPhaser.init.userID,i.userName=i.vueConfigPhaser.init.userName,i.bAskForJoinedRoom=i.vueConfigPhaser.init.bAskForJoinedRoom,i.oToWorkerAPI=i.vueConfigPhaser.oToWorkerAPI,i.oToWorkerAPI2S=i.vueConfigPhaser.oToWorkerAPI2S,i.oToPhWindowAPI=i.vueConfigPhaser.oToPhWindowAPI}preload(){this.debugText="",this.clientServer,this.waitReConnectMTimeHander=null,this.updateClientServerHander=null,this.oServerCheckingHander=null,this.doOneTimeInit=!0,this.waitReConnectMTimeHander=null,this.waitReConnectMTime=-1,this.gameStage=0,this.gametimer=0,this.playerGroup=null,this.platforms=null,this.cursors=null,this.textMiddleUp64px=null,this.clentServerPreload(),this.jDudeObj={},this.newSpriteClass={},this.syncTextList=[],this.waitReConnectMTime=-1,this.gameStage=0,this.gametimer=0;let e=this.game.config.phaser.init.gameIDorRoomID,t=this.game.config.phaser.init.userID;void 0==u[e+t]||(this.clientServer=u[e+t]),this.playerGroup=this.physics.add.group(),this.load.setPath("assets/games/"),this.load.spritesheet("dude","firstGame/dude.png",{frameWidth:32,frameHeight:48}),this.clientServer.vueConfigPhaser.oToPhaserAPI["fromBlockly"]=e=>{switch(e.cmd){case"cursorKeys":break;default:}return e},this.clientServer.vueConfigPhaser.oToPhaserAPI["store2phaserCB"]=(e,t)=>{if(this.clientServer.bActServer)switch(e){case"phaser_2PS_w2p":switch(t.subCmd){case"manyPServerIssue":this.clientServer.oToWorkerAPI({cmd:"phaser_2PS_p2w",update:{subCmd:"onePServerOnly",bActServerTime:this.clientServer.bActServerTime}});break;case"onePServerOnly":t.bActServerTime>this.clientServer.bActServerTime&&this.clientServer.oToPhWindowAPI({cmd:"onlineReload",phaser:"base",issue:"multi server"});break;case"clientChecked":void 0!=this.jDudeObj[t.userID]&&(this.jDudeObj[t.userID].isUserLeaveHide&&this.jDudeObj[t.userID].setUserLeaveHide(!1),this.jDudeObj[t.userID].checkedTime=(new Date).getTime());break;case"ping":this.clientServer.oToWorkerAPI({cmd:"phaser_BroadCast_p2w",update:{subCmd:"pong",userID:this.clientServer.userID}}),void 0!=t.userID&&void 0!=this.jDudeObj[t.userID]&&(this.jDudeObj[t.userID].isUserLeaveHide&&this.jDudeObj[t.userID].setUserLeaveHide(!1),this.jDudeObj[t.userID].checkedTime=(new Date).getTime()),this.doCountPlayerByLHide();break;case"keyPress":this.waitReConnectMTime<1&&void 0!=this[t.target][t.userID]&&(this[t.target][t.userID].doKeyPress(t.data),this[t.target][t.userID].checkedTime=(new Date).getTime(),this.jDudeObj[t.userID].isUserLeaveHide&&this.jDudeObj[t.userID].setUserLeaveHide(!1));break;case"userJoin":void 0==this.jDudeObj[t.userID]&&this.addNewUserJoin(t.userID,t.userName),this.jDudeObj[t.userID].isUserLeaveHide&&this.jDudeObj[t.userID].setUserLeaveHide(!1),this.doCountPlayerByLHide();break;default:}break;case"phaser_BroadCast_w2p":this.doPlayerBroadcast(t);break;default:}else switch(e){case"phaser_BroadCast_w2p":this.doPlayerBroadcast(t);break;case"phaser_allStatus_RES_w2p":if(0==Object.keys(t).length)break;this.clientServer.vueConfigPhaser.bClientHasAllStatus=!0,this.clientServer.bPlayerUserIDJoin?this.doOneTimeInit&&(this.doOneTimeInit=!1,this.clientServer.oToWorkerAPI({cmd:"phaser_2PS_p2w",update:{subCmd:"userJoin",userID:this.clientServer.userID,userName:this.clientServer.userName}})):this.physics.world.gravity.y=0;case"phaser_status_2C_w2p":let e=(new Date).getTime();e-this.clientServer.phaserStatusUpdateTime>2e3&&(this.clientServer.phaserStatusUpdateTime=e,this.clientServer.phaserStatusUpdateCount=0),this.clientServer.phaserStatusUpdateCount++,e-this.clientServer.phaserStatusUpdateTime>1e3&&(this.clientServer.phaserStatusUpdateCount>70&&(this.clientServer.clientUPdateTime=0,this.clientServer.oToWorkerAPI({cmd:"phaser_2PS_p2w",update:{subCmd:"manyPServerIssue",userID:this.clientServer.userID,userName:this.clientServer.userName}})),this.clientServer.phaserStatusUpdateCount=0),this.askToBeServer=!1,this.updateStatusToSpirteList(t),this.clientServer.bPlayerUserIDJoin&&void 0==this.jDudeObj[this.clientServer.userID]&&void 0!=this.clientServer.oToWorkerAPI&&this.clientServer.oToWorkerAPI({cmd:"phaser_2PS_p2w",update:{subCmd:"userJoin",userID:this.clientServer.userID,userName:this.clientServer.userName}});break;case"phaser_2S_RES_w2p":switch(t.subCmd){case"joinRoomAsk":this.clientServer.bAskForJoinedRoom=!1;break;case"beServerAsk":t.bBeServer&&(this.askToBeServer=!1,this.clientServer.bActServeUpdateAll=!1,this.clientServer.bActServer=!0,this.clientServer.bActServerTime=t.currentTime,this.clientServer.checkServerTimes=0,this.clientServer.currentUpdateFPS=0,this.clientServer.currentSendFPS=0,this.serverInit());break;default:}break;default:}},this.newGamePreload()}create(){this.debugText=this.add.text(0,0,"Client:"+this.clientServer.vueConfigPhaser.id,{fontFamily:"Arial",fontSize:"26px",fill:"#FFFFFF"}),this.debugText.setDepth(10),this.doDebueText(),this.anims.create({key:"left",frames:this.anims.generateFrameNumbers("dude",{start:0,end:3}),frameRate:10,repeat:-1}),this.anims.create({key:"turn",frames:[{key:"dude",frame:4}],frameRate:20}),this.anims.create({key:"right",frames:this.anims.generateFrameNumbers("dude",{start:5,end:8}),frameRate:10,repeat:-1}),this.platforms=this.physics.add.staticGroup(),this.textMiddleUp64px=this.add.text(p/2,m/2-128,"Game Over",{fontSize:"64px",fill:"#000"}),this.textMiddleUp64px.setDepth(10),this.textMiddleUp64px.setOrigin(.5),this.textMiddleUp64px.setStroke("#FFF",68),this.textMiddleUp64px.visible=!1,this.syncTextList.push(this.textMiddleUp64px),this.physics.add.collider(this.playerGroup,this.platforms),this.clientServer.vueConfigPhaser.bAfterCreate=!0,this.clientServer.clientUPdateTime=0,this.clientServer.checkServerTimes=0;let e=0;if(null!=this.oServerCheckingHander&&clearInterval(this.oServerCheckingHander),this.oServerCheckingHander=setInterval((()=>{if(e++,e>9){if(void 0!=this.clientServer.oMsgDebuger.fps&&this.sendDebuger({typeFPS:!0,userID:this.clientServer.userID,userName:this.clientServer.userName,gameIDorRoomID:this.clientServer.vueConfigPhaser.init.gameIDorRoomID,pServer:this.clientServer.bActServer,uFPS:this.clientServer.currentUpdateFPS,sFPS:this.clientServer.currentSendFPS}),this.clientServer.currentUpdateFPS<25&&this.waitReConnectMTime<0&&this.clientServer.bActServer){let e="Server FPS too low:"+this.clientServer.userID+" FPS:"+this.clientServer.currentUpdateFPS;this.clientServer.timsFPSTooLow--,this.clientServer.timsFPSTooLow<0&&this.clientServer.oToPhWindowAPI({cmd:"onlineReload",phaser:"base",issue:e})}e=0,this.clientServer.currentUpdateFPS=0,this.clientServer.currentSendFPS=0}this.clientServer.bActServer||(this.clientServer.checkServerTimes++,this.clientServer.clientUPdateTime++,this.clientServer.bAskForJoinedRoom?void 0!=this.clientServer.oToWorkerAPI&&this.clientServer.oToWorkerAPI2S({cmd:"phaser_2S_REQ_p2w",update:{subCmd:"joinRoomAsk"}}):(this.askToBeServer?(this.clientServer.checkServerTimes>5&&(this.clientServer.bPlayerUserIDJoin?(this.clientServer.clientUPdateTime=0,this.clientServer.oToWorkerAPI({cmd:"phaser_2PS_p2w",update:{subCmd:"ping",userID:this.clientServer.userID,userName:this.clientServer.userName}})):this.clientServer.oToWorkerAPI({cmd:"phaser_2PS_p2w",update:{subCmd:"ping"}})),this.clientServer.checkServerTimes>this.clientServer.vueConfigPhaser.nAskForServerTimeOut&&(this.clientServer.bPlayerUserIDJoin?void 0==this.jDudeObj[this.clientServer.userID]?this.clientServer.checkServerTimes>this.clientServer.vueConfigPhaser.nAskForServerTimeOut+1&&void 0!=this.clientServer.oToWorkerAPI2S&&this.clientServer.oToWorkerAPI2S({cmd:"phaser_2S_REQ_p2w",update:{subCmd:"beServerAsk"}}):void 0!=this.clientServer.oToWorkerAPI2S&&this.clientServer.oToWorkerAPI2S({cmd:"phaser_2S_REQ_p2w",update:{subCmd:"beServerAsk"}}):this.clearToNoUser())):(this.clientServer.bPlayerUserIDJoin||this.clientServer.vueConfigPhaser.bClientHasAllStatus)&&(this.askToBeServer=!0,this.clientServer.checkServerTimes=0),this.clientServer.bPlayerUserIDJoin&&this.clientServer.clientUPdateTime>20&&(this.clientServer.clientUPdateTime=0,this.clientServer.oToWorkerAPI({cmd:"phaser_2PS_p2w",update:{subCmd:"clientChecked",userID:this.clientServer.userID,userName:this.clientServer.userName}}))))}),100),this.clientServer.bPlayerUserIDJoin||this.clearToNoUser(),this.newGameCreate(),this.clientServer.bActServer){this.clientServer.askToBeServer=!1,this.clientServer.bActServeUpdateAll=!1,this.clientServer.bActServer=!0,this.clientServer.checkServerTimes=0,this.clientServer.currentUpdateFPS=0,this.clientServer.currentSendFPS=0,this.clientServer.vueConfigPhaser.bClientHasAllStatus=!1;let e=this.clientServer.playerUserIDName;e.forEach((e=>{void 0==this.jDudeObj[e.userID]&&this.addNewUserJoin(e.userID,e.userName)})),this.serverInit()}null!=this.updateClientServerHander&&clearInterval(this.updateClientServerHander),this.updateClientServerHander=setInterval((()=>{this.updateClientServer()}),28)}updateClientServer(){if(this.clientServer.currentUpdateFPS++,this.clientServer.currentSendFPS++,this.clientServer.bActServer||this.clientServer.vueConfigPhaser.bClientHasAllStatus||this.clientServer.bClientHasAllStatusAskREQCounter--<=0&&(void 0!=this.clientServer.oToWorkerAPI&&this.clientServer.oToWorkerAPI({cmd:"phaser_allStatus_REQ_p2w",update:{}}),this.clientServer.bClientHasAllStatusAskREQCounter=30),this.clientServer.bActServer&&void 0!=this.clientServer.oToWorkerAPI){let e=[{gameStage:this.gameStage,waitReConnectMTime:this.waitReConnectMTime,gametimer:this.gametimer}];this.clientServer.bActServeUpdateAll,this.clientServer.oToWorkerAPI({cmd:"phaser_status_2C_p2w",update:{dudeList:this.addSpirteListInToUpdate("jDudeObj"),syncTextList:this.addSpirteListInToUpdate("syncTextList"),syncServerVar:e}})}}update(){this.newGameUpdate()}doDestroy(){null!=this.oServerCheckingHander&&clearInterval(this.oServerCheckingHander),null!=this.waitReConnectMTimeHander&&clearInterval(this.waitReConnectMTimeHander),null!=this.updateClientServerHander&&clearInterval(this.updateClientServerHander),this.clientServer.vueConfigPhaser.oToPhaserAPI["store2phaserCB"]=void 0,this.playerGroup.clear(!0,!0)}destroy(){this.doDestroy()}addNewUserJoin(e,t){this.jDudeObj[e]=new v(this,e,t),this.playerGroup.add(this.jDudeObj[e]),this.jDudeObj[e].setBounce(.2),this.jDudeObj[e].setCollideWorldBounds(!0),this.jDudeObj[e].x=this.jDudeObj[e].x+Math.floor(200*Math.random())-100,this.jDudeObj[e].start(),this.doCountPlayerByLHide()}serverInit(){this.doDebueText(),void 0==this.jDudeObj[this.clientServer.userID]&&(this.jDudeObj[this.clientServer.userID]=new v(this,this.clientServer.userID,this.clientServer.userName),this.jDudeObj[this.clientServer.userID].start(),this.playerGroup.add(this.jDudeObj[this.clientServer.userID])),this.doCountPlayerByLHide(),this.clientServer.vueConfigPhaser.bClientHasAllStatus?(this.waitReConnectMTime=15e3,this.textMiddleUp64px.setText(parseInt(this.waitReConnectMTime/1e3)),this.textMiddleUp64px.visible=!0,null!=this.waitReConnectMTimeHander&&clearInterval(this.waitReConnectMTimeHander),this.waitReConnectMTimeHander=setInterval((()=>{this.waitReConnectMTime-=100,this.textMiddleUp64px.setText(parseInt(this.waitReConnectMTime/1e3)),this.waitReConnectMTime<0&&(this.textMiddleUp64px.visible=!1,this.serverStart(),clearInterval(this.waitReConnectMTimeHander))}),100)):(this.waitReConnectMTime=0,this.serverStart())}serverStart(){this.clientServer.bActServeUpdateAll=!0,this.playerGroup.clear(!1,!1),Object.keys(this.jDudeObj).forEach((e=>{let t=this.jDudeObj[e];this.playerGroup.add(t),t.setBounce(.2),t.setCollideWorldBounds(!0)}))}doCountPlayerByLHide(){this.clientServer.playerCount=0,this.clientServer.playerUserIDName=[],Object.keys(this.jDudeObj).forEach((e=>{let t=this.jDudeObj[e];t.isUserLeaveHide||(this.clientServer.playerCount++,this.clientServer.playerUserIDName.push({userID:t.userID,userName:t.userName}))})),this.doDebueText()}addSpirteListInToUpdate(e){let t=[];if("jDudeObj"==e){let r=(new Date).getTime(),s=!1;for(let a of Object.keys(this[e])){let o,n=this[e][a];void 0==n.checkedTime&&(n.checkedTime=r);try{o={userID:a,x:n.x,y:n.y,animKey:n.anims.currentAnim.key,userName:n.userName,score:n.score,active:n.active,visible:n.visible,textAddingScore:n.textAddingScore._text,isUserLeaveHide:n.isUserLeaveHide}}catch(i){}a!=this.clientServer.userID&&(n.isUserLeaveHide||r-n.checkedTime>3e3&&(n.setUserLeaveHide(!0),s=!0)),t.push(o)}s&&this.doCountPlayerByLHide()}else for(let r of this[e])switch(e){case"starList":case"syncTextList":t.push({syncText:r._text,visible:r.visible});break;default:t.push({x:r.x,y:r.y})}return t}newSpriteClassPlayerDude(e,t){let i=new v(this,t.userID,t.userName);this[e][t.userID]=i,i.start(),this.playerGroup.add(i),i.setCollideWorldBounds(!0),this.doCountPlayerByLHide()}createSpriteUntilIndex(e,t){for(let i=0;i<=t;i++)if(void 0==this[e][i]){let t=this.newSpriteClass[e](this,i);void 0!=t&&this[e].push(t)}}updateStatus_dude(e,t,i){for(let r of Object.keys(e[t])){let s=e[t][r];if((this.clientServer.bPlayerUserIDJoin||s.userID!=this.clientServer.userID)&&s.active){void 0==this[i][s.userID]&&this.newSpriteClassPlayerDude(i,s);let e=this[i][s.userID];for(let t in s)switch(t){case"userID":break;case"animKey":void 0!=e.anims.currentAnim&&e.anims.currentAnim.key==s[t]||e.play(s[t]);break;case"userName":e.userName!=s[t]&&(e.userName=s[t],e.textName.setText(s[t]));break;case"score":e.score!=s[t]&&(e.score=s[t],e.textScore.setText("S:"+s[t]));break;case"textAddingScore":e.textAddingScore._text!=s[t]&&e.setAddingScoreText(s[t]);break;case"isUserLeaveHide":e.isUserLeaveHide!=s[t]&&e.setUserLeaveHide(s[t]),e.userID==this.clientServer.userID&&e.isUserLeaveHide&&this.clientServer.oToWorkerAPI({cmd:"phaser_2PS_p2w",update:{subCmd:"userJoin",userID:this.clientServer.userID,userName:this.clientServer.userName}});break;default:e[t]=s[t]}}}}updateStatusToSpirteList(e){for(let t of Object.keys(e))if("syncServerVar"==t){for(let i of Object.keys(e[t])){let r=e[t][i];for(let e of Object.keys(r))this[e]=r[e]}this.waitReConnectMTime>0&&(this.textMiddleUp64px.setText(parseInt(this.waitReConnectMTime/1e3)),this.textMiddleUp64px.visible=!0,this.clientServer.clientUPdateTime=0,this.clientServer.oToWorkerAPI({cmd:"phaser_2PS_p2w",update:{subCmd:"ping",userID:this.clientServer.userID,userName:this.clientServer.userName}}))}else if("dudeList"==t)this.updateStatus_dude(e,t,"jDudeObj");else for(let i of Object.keys(e[t])){let r=parseInt(i);r>=this[t].length&&this.createSpriteUntilIndex(t,r);let s=e[t][i],a=this[t][r];for(let e in s)switch(e){case"animKey":void 0!=a.anims.currentAnim&&a.anims.currentAnim.key==s[e]||a.play(s[e]);break;case"syncText":a.setText(s[e]);break;default:a[e]=s[e]}}}doPlayerBroadcast(e){switch(e.subCmd){case"oMsgDebuger":void 0!=e.userID&&e.userID!=this.clientServer.userID||(this.clientServer.oMsgDebuger=e.oMsgDebuger);break;case"say":void 0!=this[e.target][e.userID]&&(this[e.target][e.userID].sayWhat=e.data,this[e.target][e.userID].checkedTime=(new Date).getTime());break;case"ping":break;case"pong":this.askToBeServer=!1;break;case"destroy":this.doDestroy();break;case"userLeave":void 0!=this.jDudeObj[e.userID]&&(this.clientServer.bActServer||(this.jDudeObj[e.userID].myDestroy(),this.jDudeObj[e.userID].destroy(),delete this.jDudeObj[e.userID],this.doCountPlayerByLHide()));break;default:}}clearToNoUser(){this.clientServer.vueConfigPhaser.bClientHasAllStatus=!1,this.askToBeServer=!1,this.textMiddleUp64px.setText("Demo mode"),this.textMiddleUp64px.visible=!0,Object.keys(this.jDudeObj).forEach((e=>{let t=this.jDudeObj[e];t.myDestroy(),t.destroy(),delete this.jDudeObj[e]})),this.doCountPlayerByLHide()}doDebueText(){this.debugText.setText((this.clientServer.bActServer?"Server:":"Client:")+this.clientServer.userName+" 連線人數:"+this.clientServer.playerCount)}sendDebuger(e){}preRestart(){this.doDestroy(),this.updateClientServer();let e=this.clientServer.oToPhWindowAPI;u[this.gameIDorRoomID+this.userID]=void 0,setTimeout((()=>{e({cmd:"replayReload",phaser:"base",issue:"reStart"})}),3e3)}newGamePreload(){}newGameCreate(){}newGameUpdate(){}}var I=i(20980),D=i(45291);const b=["id"],x={__name:"phaserVue",props:{init:{type:Object,default:()=>({x:10,y:50,bPlayerUserIDJoin:!1,sPhaserID:"pBase"+Math.random().toFixed(8).slice(2),gameIDorRoomID:"theGameIDorRoomID",userID:"qqqqMapping0",userName:"qqqq Name",nSpriteIndex:0,zIndex:"+3",nSpriteIndex:1,zIndex:"+0"})},watchKeyboard:{type:Boolean,default:!0},oToPhWindowAPI:{type:Function,default:()=>null}},setup(e){const t=e,i=(0,h.Y)(),s=(0,l.X)(),o=((0,I.f)(),(0,D.u)());let n=(0,a.KR)(t.init.sPhaserID),d={},u=(0,a.KR)(t.init.gameIDorRoomID),c="";function v(e,t){let i=d.config.phaser;if(i.bAfterCreate){let r=i.oToPhaserAPI.store2phaserCB;if(void 0!=r)return r(e,t)}}function x(e){s.sourcePhaserToWorkerAndSend(e.cmd,{update:e.update,gameIDorRoomID:u.value,sPhaserID:n.value})}function y(e){s.sourcePhaserToWorkerAndSend(e.cmd,{update:e.update,gameIDorRoomID:u.value,sPhaserID:n.value,targetMirror:t.init.targetMirror,targetPhaserName:t.init.targetPhaserName})}return(0,r.wB)((()=>o.keyChange),(()=>{let e=o.keyCode;if(t.init.bPlayerUserIDJoin&&t.watchKeyboard){let i="";switch(e){case"ArrowLeft":i="left";break;case"ArrowRight":i="right";break;case"ArrowUp":i="up";break;case"ArrowDown":i="down";break;default:}c!=i&&(c=i,x({cmd:"phaser_2PS_p2w",update:{subCmd:"keyPress",target:"jDudeObj",userID:t.init.userID,data:i}}))}}),{immediate:!0}),(0,r.sV)((()=>{const e={type:Phaser.WEBGL,pixelArt:!0,width:p,height:m,parent:n.value,physics:{default:"arcade",arcade:{gravity:{y:0}}},scene:[S]};d=new Phaser.Game(e),d.events.addListener(Phaser.Core.Events.FOCUS,(()=>{}),this),d.events.addListener(Phaser.Core.Events.BLUR,(()=>{}),this),d.events.addListener(Phaser.Core.Events.PAUSE,(()=>{t.oToPhWindowAPI({cmd:"PAUSE",phaser:"base",issue:"Phaser PAUSE"})}),this),d.events.addListener(Phaser.Core.Events.RESUME,(()=>{t.oToPhWindowAPI({cmd:"onlineReload",phaser:"base",issue:"Phaser RESUME"})}),this),d.config.phaser={id:n.value,init:t.init,scene:"boot",oToPhaserAPI:{},oToWorkerAPI:x,oToWorkerAPI2S:y,oToPhWindowAPI:t.oToPhWindowAPI,oStatusFromServer:{},bClientHasAllStatus:!1,bAfterCreate:!1,nAskForServerTimeOut:10},i.registerGame(d.config.phaser),s.registerPhaserCBByGameIDorRoomID(n.value,u.value,v)})),(0,r.hi)((()=>{v("phaser_BroadCast_w2p",{subCmd:"destroy"}),i.unRegisterGame(n.value),d.destroy(),s.registerPhaserCBByGameIDorRoomID(n.value,u.value,void 0);let e=d.config.phaser;e.bAfterCreate&&(e.oToPhaserAPI.store2phaserCB=void 0)})),(e,t)=>((0,r.uX)(),(0,r.CE)("div",{id:(0,a.R1)(n)},null,8,b))}},y=x,g=y;var k=i(14907);const P={class:"windowAPPBodyCSS"},f={class:"moveTop6px"},w={class:"moveBottom6px"},T={class:"moveRight6px"},C={class:"moveLeft6px"},A={__name:"phaserWindow",props:{init:{type:Object,default:()=>({x:10,y:50,bPlayerUserIDJoin:!1,sPhaserID:"pBase"+Math.random().toFixed(8).slice(2),gameIDorRoomID:"theGameIDorRoomID",userID:"qqqqMapping0",userName:"qqqq Name",nSpriteIndex:0,zIndex:"+3",nSpriteIndex:1,zIndex:"+0"})},windowReStyle:{type:Number,default:0},moveWindowAble:{type:Boolean,default:!1},watchKeyboard:{type:Boolean,default:!0}},emits:["doExit"],setup(e,{emit:t}){const i=(0,D.u)(),o=((0,k.A)(),e),u=(0,l.X)(),c=((0,h.Y)(),(0,a.KR)(3)),v=p+3,S=m+c.value,I=m/p,b=300*I+c.value,x=(0,a.Kh)({style:"top:"+o.init.top+"px;left:"+o.init.left+"px;width:"+(o.init.width?o.init.width:803)+"px;max-width:"+v+"px;max-height:"+S+"px;z-index: "+o.init.zIndex+";min-height:"+b+"px;height:"+(o.init.height?o.init.height:603)+"px",top:o.init.top,left:o.init.left,width:o.init.width?o.init.width:803,height:o.init.height?o.init.height:603,realWidth:o.init.width?o.init.width:803,realHeight:o.init.height?o.init.height:603,maximizedMode:1,isDisplay:!0}),y=(0,a.KR)(!0),A=(0,a.KR)(!0),F=(0,a.KR)(""),U=(0,a.KR)(0),R=(0,a.KR)(!1),M=t;let H=null;function j(){o.watchKeyboard&&(y.value=!y.value)}function _(){U.value!=x.top&&(U.value=x.top,window.dispatchEvent(new Event("resize")))}function O(){null!=H&&clearTimeout(H),H=setTimeout((()=>{H=null,W()}),300)}function W(){let e=(x.realWidth-3)/p,t=(x.width-3-p)/2,i=(x.height-c.value-m)/2,s=(x.realHeight-c.value)/m;F.value="position: absolute;z-index: +1;top:"+i+"px;left:"+t+"px;transform:scale("+e+", "+s+")",x.style="both;top:"+x.top+"px;left:"+x.left+"px;width:"+x.width+"px;max-width:"+v+"px;max-height:"+S+"px;z-index: "+o.init.zIndex+";min-height:"+b+"px;height:"+x.height+"px",(0,r.dY)((()=>{window.dispatchEvent(new Event("resize"))}))}function B(e){d.count=e.width,e.width>0&&(x.realWidth=e.width,x.realHeight=e.height,2!=x.maximizedMode&&(x.width=x.realWidth,x.height=x.realHeight,W(),O()))}function N(e){switch(x.top+=e.delta.y,x.left+=e.delta.x,x.maximizedMode){case 1:x.style="both;top:"+x.top+"px;left:"+x.left+"px;width:"+x.width+"px;max-width:"+v+"px;max-height:"+S+"px;z-index: "+o.init.zIndex+";min-height:"+b+"px;height:"+x.height+"px";break;case 2:x.style="top:"+x.top+"px;left:"+x.left+"px;width:auto;height:auto";break;default:}e.isFirst?0==x.maximizedMode&&(x.top=e.position.top,x.left=e.position.left,x.style="both;top:"+x.top+"px;left:"+x.left+"px;width:"+x.width+"px;max-width:"+v+"px;max-height:"+S+"px;z-index: "+o.init.zIndex+";min-height:"+b+"px;height:"+x.height+"px",x.maximizedMode=1):e.isFinal}function L(){u.sourcePhaserToWorkerAndSend("phaser_BroadCast_p2w",{update:{subCmd:"say",target:"jDudeObj",userID:o.init.userID,data:"Hellow!連線人數I am ID:"+o.init.nSpriteIndex},gameIDorRoomID:o.init.gameIDorRoomID,sPhaserID:o.init.sPhaserID})}function z(){x.maximizedMode=1,x.height=(x.realWidth-3)*I+c.value,W()}function E(e){switch(e.cmd){case"PAUSE":u.bLoopMode||(A.value=!1);break;case"replayReload":A.value=!1,(0,r.dY)((()=>{A.value=!0}));break;case"onlineReload":u.bLoopMode||(A.value=!1,(0,r.dY)((()=>{A.value=!0})));break;default:}}return(0,r.wB)((()=>x.realWidth),(e=>{O()}),{immediate:!0}),(0,r.wB)((()=>o.windowReStyle),(e=>{x.left=o.init.left,x.top=o.init.top,W()}),{immediate:!0}),(0,r.sV)((()=>{y.value=o.watchKeyboard,W(),setTimeout((()=>{R.value=!0}),5e3)})),(0,r.hi)((()=>{null!=H&&clearTimeout(H)})),(t,h)=>{const l=(0,r.g2)("q-tooltip"),d=(0,r.g2)("q-btn"),u=(0,r.g2)("q-bar"),c=(0,r.g2)("q-icon"),p=(0,r.g2)("q-resize-observer"),m=(0,r.g2)("q-card"),v=(0,r.gN)("touch-pan");return(0,r.uX)(),(0,r.CE)("div",{onClick:h[6]||(h[6]=(0,n.D$)((e=>(0,a.R1)(i).onClickForMainInput(e)),["stop"])),onMousemove:_},[(0,r.bo)((0,r.bF)(m,{class:"windowAPPCSS",style:(0,s.Tr)(x.style)},{default:(0,r.k6)((()=>[o.moveWindowAble?((0,r.uX)(),(0,r.Wv)(u,{key:0,class:"hideBar"},{default:(0,r.k6)((()=>[(0,r.bF)(d,{dense:"",flat:"",icon:"fas fa-solid fa-bug",onClick:h[0]||(h[0]=(0,n.D$)((e=>L()),["prevent","stop"]))},{default:(0,r.k6)((()=>[(0,r.bF)(l,{class:"bg-white text-primary"},{default:(0,r.k6)((()=>h[7]||(h[7]=[(0,r.eW)("Debug")]))),_:1})])),_:1}),(0,r.bF)(d,{dense:"",flat:"",icon:y.value?"keyboard_hide":"keyboard",onClick:h[1]||(h[1]=(0,n.D$)((e=>j()),["prevent","stop"]))},{default:(0,r.k6)((()=>[(0,r.bF)(l,{class:"bg-white text-primary"},{default:(0,r.k6)((()=>h[8]||(h[8]=[(0,r.eW)("key")]))),_:1})])),_:1},8,["icon"]),(0,r.bF)(d,{dense:"",flat:"",icon:"crop_square",onClick:h[2]||(h[2]=e=>z()),disable:0==x.maximizedMode},{default:(0,r.k6)((()=>[0==!x.maximizedMode?((0,r.uX)(),(0,r.Wv)(l,{key:0,class:"bg-white text-primary"},{default:(0,r.k6)((()=>h[9]||(h[9]=[(0,r.eW)("Aspect ratio")]))),_:1})):(0,r.Q3)("",!0)])),_:1},8,["disable"]),(0,r.bF)(d,{dense:"",flat:"",icon:"close",onClick:h[3]||(h[3]=e=>A.value=!A.value)},{default:(0,r.k6)((()=>[(0,r.bF)(l,{class:"bg-white text-primary"},{default:(0,r.k6)((()=>h[10]||(h[10]=[(0,r.eW)("Close")]))),_:1})])),_:1})])),_:1})):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[R.value?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[o.init.bPlayerUserIDJoin?((0,r.uX)(),(0,r.Wv)(u,{key:0,class:"hideBar"},{default:(0,r.k6)((()=>[(0,r.bF)(c,{style:{cursor:"pointer"},name:y.value?"keyboard_hide":"keyboard",onClick:h[4]||(h[4]=(0,n.D$)((e=>j()),["prevent","stop"])),title:"key board"},null,8,["name"]),(0,r.bF)(c,{style:{cursor:"pointer"},name:"logout",onClick:h[5]||(h[5]=(0,n.D$)((e=>M("doExit")),["prevent","stop"])),title:"Exit"})])),_:1})):(0,r.Q3)("",!0)],64)):(0,r.Q3)("",!0)],64)),(0,r.bo)((0,r.Lk)("div",P,[A.value?((0,r.uX)(),(0,r.Wv)(g,{key:0,style:(0,s.Tr)(F.value),init:e.init,watchKeyboardLocal:y.value,oToPhWindowAPI:E},null,8,["style","init","watchKeyboardLocal"])):(0,r.Q3)("",!0)],512),[[n.aG,2!=x.maximizedMode]]),(0,r.bF)(p,{onResize:B}),o.moveWindowAble?((0,r.uX)(),(0,r.CE)(r.FK,{key:2},[(0,r.bo)((0,r.Lk)("div",f,null,512),[[v,N,void 0,{prevent:!0,mouse:!0}]]),(0,r.bo)((0,r.Lk)("div",w,null,512),[[v,N,void 0,{prevent:!0,mouse:!0}]]),(0,r.bo)((0,r.Lk)("div",T,null,512),[[v,N,void 0,{prevent:!0,mouse:!0}]]),(0,r.bo)((0,r.Lk)("div",C,null,512),[[v,N,void 0,{prevent:!0,mouse:!0}]])],64)):(0,r.Q3)("",!0)])),_:1},8,["style"]),[[n.aG,x.isDisplay]])],32)}}};var F=i(12807),U=i(23316),R=i(18670),M=i(1693),H=i(97410),j=i(50492),_=i(1096),O=i(89390),W=i(98582),B=i.n(W);const N=(0,F.A)(A,[["__scopeId","data-v-e7b9f1e8"]]),L=N;B()(A,"components",{QCard:U.A,QBar:R.A,QBtn:M.A,QTooltip:H.A,QIcon:j.A,QResizeObserver:_.A}),B()(A,"directives",{TouchPan:O.A});var z=i(23537);const E={class:"mainflexcontainer"},J=["innerHTML"],K=["innerHTML"],q={class:"phaserArea"},G={__name:"normalBase",setup(e){const t=(0,h.Y)(),n=(0,a.Kh)({gameIDorRoomID:"normalBaseIDorRoomID"+Math.random().toFixed(3).slice(2),phServerChangeTime:0,userCurrent:0,userMax:10}),d=(0,a.Kh)({showup:!0,init:{left:820,top:50,width:320,height:180,sPhaserID:"pBase"+Math.random().toFixed(8).slice(2),gameIDorRoomID:n.gameIDorRoomID,bAskForJoinedRoom:!1,userID:"1_"+Math.random().toFixed(8).slice(2),userName:"1_"+Math.random().toFixed(8).slice(2),zIndex:"+5"}}),u=(0,a.Kh)({showup:!1,init:{left:450,top:50,sPhaserID:"pBase"+Math.random().toFixed(8).slice(2),gameIDorRoomID:n.gameIDorRoomID,userID:"2_"+Math.random().toFixed(8).slice(2),userName:"2_"+Math.random().toFixed(8).slice(2),zIndex:"+6"}}),c=(0,a.Kh)({showup:!0,init:{left:820,top:250,width:320,height:180,sPhaserID:"pBase"+Math.random().toFixed(8).slice(2),gameIDorRoomID:n.gameIDorRoomID,bAskForJoinedRoom:!1,userID:"3_"+Math.random().toFixed(8).slice(2),userName:"3_"+Math.random().toFixed(8).slice(2),zIndex:"+2"}}),p=(0,a.Kh)({showup:!1,init:{left:80,top:420,sPhaserID:"pBase"+Math.random().toFixed(8).slice(2),gameIDorRoomID:n.gameIDorRoomID,userID:"4_"+Math.random().toFixed(8).slice(2),userName:"4_"+Math.random().toFixed(8).slice(2),zIndex:"+3"}}),m=(0,a.Kh)({showup:!1,init:{left:450,top:420,sPhaserID:"pBase"+Math.random().toFixed(8).slice(2),gameIDorRoomID:n.gameIDorRoomID,userID:"5_"+Math.random().toFixed(8).slice(2),userName:"5_"+Math.random().toFixed(8).slice(2),zIndex:"+3"}}),v=(0,a.Kh)({showup:!1,init:{left:820,top:420,sPhaserID:"pBase"+Math.random().toFixed(8).slice(2),gameIDorRoomID:n.gameIDorRoomID,userID:"6_"+Math.random().toFixed(8).slice(2),userName:"6_"+Math.random().toFixed(8).slice(2),zIndex:"+2"}});i(7958);const S=(0,I.f)(),b=(0,D.u)(),x=(0,l.X)(),{t:y,locale:g}=(0,z.s9)();(0,a.KR)(!1);function k(){x.sourcePhaserToWorkerAndSend("phaser_BroadCast_p2w",{update:{subCmd:"oMsgDebuger",oMsgDebuger:{fps:!0,userJoin:!0}},gameIDorRoomID:n.gameIDorRoomID,sPhaserID:"abc"})}function P(){u.init.bPlayerUserIDJoin=!0,u.showup=!1,(0,r.dY)((()=>{u.showup=!0}))}function f(e){e.sServerPhaserID="pBase"+Math.random().toFixed(8).slice(2),d.init={left:380,top:50,sPhaserID:e.sServerPhaserID,gameIDorRoomID:e.gameIDorRoomID,userID:"qqqqMapping0",userName:"qqqq Name",nSpriteIndex:0,zIndex:"+3"},d.showup=!0}function w(e){if(e.userCurrent<e.userMax){e.userCurrent++;let t="playerWindow20"+Math.random().toFixed(8).slice(2),i="two Name"+Math.random().toFixed(8).slice(2);u.init={left:750,top:50,sPhaserID:"pBase"+Math.random().toFixed(8).slice(2),gameIDorRoomID:e.gameIDorRoomID,userID:t,userName:i,zIndex:"+3"},u.showup=!0}if(e.userCurrent<e.userMax){e.userCurrent++;let t="playerWindow30"+Math.random().toFixed(8).slice(2),i="three Name"+Math.random().toFixed(8).slice(2);c.init={left:1120,top:50,sPhaserID:"pBase"+Math.random().toFixed(8).slice(2),gameIDorRoomID:e.gameIDorRoomID,userID:t,userName:i,zIndex:"+2"},c.showup=!0}}(0,r.wB)((()=>b.localStorage.localeUI),(e=>{null!=e&&localeChange()})),(0,r.wB)((()=>b.localStorage.localeBlockly),(e=>{null!=e&&localeChange()}));let T=null;return(0,r.sV)((()=>{x.bLoopMode=!0})),(0,r.hi)((()=>{S.exitJSCode(),null!=T&&clearInterval(T)})),(e,i)=>{const h=(0,r.g2)("q-btn");return(0,r.uX)(),(0,r.CE)("div",E,[(0,r.eW)(" webWorkerPinia.bLoopMode:"+(0,s.v_)((0,a.R1)(x).bLoopMode)+" ",1),i[10]||(i[10]=(0,r.Lk)("br",null,null,-1)),(0,r.bF)(h,{style:{margin:"2px"},color:"primary",label:"Debug",onClick:i[0]||(i[0]=e=>k())}),(0,r.bF)(h,{style:{margin:"2px"},color:"primary",label:"N",onClick:i[1]||(i[1]=e=>f(n))}),(0,r.bF)(h,{style:{margin:"2px"},color:"primary",label:"J",onClick:i[2]||(i[2]=e=>w(n))}),(0,r.bF)(h,{style:{margin:"2px"},color:"primary",label:"window 1",onClick:i[3]||(i[3]=()=>{d.init.sPhaserID="pBase"+Math.random().toFixed(8).slice(2),d.showup=!d.showup})}),(0,r.bF)(h,{style:{margin:"2px"},color:"primary",label:"window 2",onClick:i[4]||(i[4]=()=>{u.showup||(u.init.sPhaserID="pBase"+Math.random().toFixed(8).slice(2)),u.showup=!u.showup})}),(0,r.bF)(h,{style:{margin:"2px"},color:"primary",label:"window 2 Player Jump in",onClick:i[5]||(i[5]=e=>P())}),(0,r.bF)(h,{style:{margin:"2px"},color:"primary",label:"window 3",onClick:i[6]||(i[6]=()=>{c.init.sPhaserID="pBase"+Math.random().toFixed(8).slice(2),c.showup=!c.showup})}),(0,r.bF)(h,{style:{margin:"2px"},color:"primary",label:"window 4",onClick:i[7]||(i[7]=()=>{p.init.sPhaserID="pBase"+Math.random().toFixed(8).slice(2),p.showup=!p.showup})}),(0,r.bF)(h,{style:{margin:"2px"},color:"primary",label:"window 5",onClick:i[8]||(i[8]=()=>{m.init.sPhaserID="pBase"+Math.random().toFixed(8).slice(2),m.showup=!m.showup})}),(0,r.bF)(h,{style:{margin:"2px"},color:"primary",label:"window 6",onClick:i[9]||(i[9]=()=>{v.init.sPhaserID="pBase"+Math.random().toFixed(8).slice(2),v.showup=!v.showup})}),(0,r.Lk)("pre",{innerHTML:JSON.stringify(n,null,2)},null,8,J),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)((0,a.R1)(t).debugUserIDList,((e,i)=>((0,r.uX)(),(0,r.CE)("div",{key:i},[(0,r.Lk)("pre",{innerHTML:JSON.stringify((0,a.R1)(t).debugInfoObj[e],null,2)},null,8,K)])))),128)),(0,r.Lk)("div",q,[d.showup?((0,r.uX)(),(0,r.Wv)(o["default"],{key:0,init:d.init},null,8,["init"])):(0,r.Q3)("",!0),u.showup?((0,r.uX)(),(0,r.Wv)(L,{key:1,init:u.init,moveWindowAble:!0},null,8,["init"])):(0,r.Q3)("",!0),c.showup?((0,r.uX)(),(0,r.Wv)(o["default"],{key:2,init:c.init},null,8,["init"])):(0,r.Q3)("",!0),p.showup?((0,r.uX)(),(0,r.Wv)(o["default"],{key:3,init:p.init},null,8,["init"])):(0,r.Q3)("",!0),m.showup?((0,r.uX)(),(0,r.Wv)(o["default"],{key:4,init:m.init},null,8,["init"])):(0,r.Q3)("",!0),v.showup?((0,r.uX)(),(0,r.Wv)(o["default"],{key:5,init:v.init},null,8,["init"])):(0,r.Q3)("",!0)])])}}},Q=(0,F.A)(G,[["__scopeId","data-v-38cf8825"]]),X=Q;B()(G,"components",{QBtn:M.A})}}]);